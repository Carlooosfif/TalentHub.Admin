@using Microsoft.AspNetCore.Http

@{
    Layout = null;
    var title = ViewData["Title"] as string ?? "TalentHub Admin";
    var rol = Context.Session.GetString("Rol");
    var email = Context.Session.GetString("Email");
    var haySesion = !string.IsNullOrEmpty(rol);
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>@title - TalentHub</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />

    <!-- Estilos propios -->
    <link rel="stylesheet" href="~/css/main.css" />
</head>
<body>
    <div class="layout">

        <!-- NAVBAR -->
        <header class="navbar">
            <div class="navbar__left">
                <div class="navbar__brand">
                    <div class="navbar__logo">TH</div>
                    <div>
                        <div class="navbar__title">TalentHub Admin</div>
                        @if (haySesion)
                        {
                            <small class="text-muted">
                                @email (@rol)
                            </small>
                        }
                    </div>
                </div>
            </div>

            <div class="navbar__links">
                <button id="themeToggle" class="navbar__theme-btn" type="button">
                    🌙 / ☀️
                </button>

                @if (haySesion)
                {
                    <a asp-controller="Home" asp-action="Index" class="navbar__link">Inicio</a>
                    <a asp-controller="Areas" asp-action="Index" class="navbar__link">Áreas</a>
                    <a asp-controller="Supervisores" asp-action="Index" class="navbar__link">Supervisores</a>
                    <a asp-controller="Empleados" asp-action="Index" class="navbar__link">Empleados</a>
                    <a asp-controller="Vacantes" asp-action="Index" class="navbar__link navbar__link--primary">
                        Vacantes
                    </a>

                    <!-- Cerrar sesión -->
                    <a asp-controller="Account"
                       asp-action="Logout"
                       class="navbar__link text-danger">
                        Cerrar sesión
                    </a>
                }
            </div>
        </header>

        <!-- CONTENIDO -->
        <main class="layout__main">
            <section class="layout__content">
                @RenderBody()
            </section>
        </main>

        <!-- FOOTER -->
        <footer class="layout__footer">
            <p class="footer__text">
                TalentHub · @DateTime.Now.Year · Gestión de talento interno
            </p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        (function () {
            const THEME_KEY = "talenthub-theme";
            const body = document.body;

            function applyTheme(theme) {
                body.classList.remove("theme-light", "theme-dark");
                body.classList.add(theme);
            }

            document.addEventListener("DOMContentLoaded", function () {
                let savedTheme = localStorage.getItem(THEME_KEY);

                if (savedTheme !== "theme-light" && savedTheme !== "theme-dark") {
                    const prefersDark = window.matchMedia &&
                        window.matchMedia("(prefers-color-scheme: dark)").matches;
                    savedTheme = prefersDark ? "theme-dark" : "theme-light";
                }

                applyTheme(savedTheme);

                const btn = document.getElementById("themeToggle");
                if (!btn) return;

                function updateButton(theme) {
                    btn.textContent = theme === "theme-dark" ? "🌙 / ☀️" : "🌞 / 🌜";
                }

                updateButton(savedTheme);

                btn.addEventListener("click", function () {
                    const newTheme = body.classList.contains("theme-dark")
                        ? "theme-light"
                        : "theme-dark";

                    applyTheme(newTheme);
                    localStorage.setItem(THEME_KEY, newTheme);
                    updateButton(newTheme);
                });
            });
        })();
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
